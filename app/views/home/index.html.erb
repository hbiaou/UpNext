<div class="min-h-screen bg-background flex flex-col" data-controller="tasks">
  <!-- Top Header -->
  <header class="border-b border-border bg-card px-6 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <%= image_tag "upnext-logo.svg", 
            alt: "UpNext Logo", 
            class: "h-8 w-8", 
            loading: "eager" %>
        <h1 class="text-xl font-bold text-navy">UpNext</h1>
      </div>
      
      <div class="flex items-center gap-2">
        <!-- Settings button -->
        <button 
          data-controller="settings"
          data-action="click->settings#open"
          class="p-2 hover:bg-accent rounded-lg transition-colors"
          title="Settings"
        >
          <svg class="h-5 w-5 text-foreground" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
          </svg>
        </button>

        <!-- Mobile menu toggle -->
        <button id="mobile-menu-toggle" class="md:hidden p-2 hover:bg-accent rounded-lg">
          <svg class="h-5 w-5 text-foreground" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Two-Panel Layout -->
  <main class="flex-1 grid grid-cols-1 md:grid-cols-[320px_1fr] h-[calc(100vh-73px)]">
    
    <!-- Left Panel: AI Chat -->
    <aside class="border-r border-border bg-card flex flex-col" data-controller="chat">
      <!-- Chat Header -->
      <div class="p-4 border-b border-border">
        <div class="flex items-center gap-3">
          <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center">
            <svg class="h-4 w-4 text-primary" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A2,2 0 0,1 14,4C14,5.5 13,6.19 13,7.5V9A1,1 0 0,1 12,10A1,1 0 0,1 11,9V7.5C11,6.19 10,5.5 10,4A2,2 0 0,1 12,2M21,9V7H15V9H21M9,9V7H3V9H9M11,22A1,1 0 0,1 10,21V19A1,1 0 0,1 11,18H13A1,1 0 0,1 14,19V21A1,1 0 0,1 13,22H11M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
            </svg>
          </div>
          <div>
            <h2 class="font-semibold text-foreground">AI Assistant</h2>
            <p class="text-xs text-muted-foreground">Ready to help with your tasks</p>
          </div>
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="flex-1 overflow-y-auto p-4 space-y-4" data-chat-target="messages">
        <!-- Welcome Message -->
        <div class="flex gap-3">
          <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
            <svg class="h-4 w-4 text-primary" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,2A2,2 0 0,1 14,4C14,5.5 13,6.19 13,7.5V9A1,1 0 0,1 12,10A1,1 0 0,1 11,9V7.5C11,6.19 10,5.5 10,4A2,2 0 0,1 12,2M21,9V7H15V9H21M9,9V7H3V9H9M11,22A1,1 0 0,1 10,21V19A1,1 0 0,1 11,18H13A1,1 0 0,1 14,19V21A1,1 0 0,1 13,22H11M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
            </svg>
          </div>
          <div class="bg-secondary/50 rounded-lg p-3 max-w-[80%]">
            <p class="text-sm text-foreground">Hi! I'm your AI assistant. I can help you create tasks, organize your day, and stay productive. Try saying something like "Add a task to call mom tomorrow" or "Show me what I need to do today".</p>
          </div>
        </div>
      </div>

      <!-- Chat Input -->
      <div class="p-4 border-t border-border">
        <form data-chat-target="form" data-action="submit->chat#sendMessage" class="flex gap-2">
          <input
            data-chat-target="input"
            type="text"
            placeholder="Ask me to help with your tasks..."
            class="flex-1 px-3 py-2 text-sm border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
          <button
            type="submit"
            class="bg-primary text-primary-foreground px-3 py-2 rounded-lg hover:bg-primary/90 transition-colors"
          >
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
            </svg>
          </button>
        </form>
      </div>
    </aside>

    <!-- Right Panel: Task Manager -->
    <section class="flex flex-col bg-background">
      <!-- Task Tabs -->
      <div class="border-b border-border bg-card">
        <nav class="flex" data-tasks-target="tabs">
          <button 
            class="px-4 py-3 text-sm font-medium text-primary border-b-2 border-primary bg-primary/5"
            data-tab="today"
            data-action="click->tasks#switchTab"
          >
            üóìÔ∏è Today
          </button>
          <button 
            class="px-4 py-3 text-sm font-medium text-muted-foreground hover:text-foreground"
            data-tab="upcoming"
            data-action="click->tasks#switchTab"
          >
            ‚åö Upcoming
          </button>
          <button 
            class="px-4 py-3 text-sm font-medium text-muted-foreground hover:text-foreground"
            data-tab="completed"
            data-action="click->tasks#switchTab"
          >
            ‚úÖ Completed
          </button>
        </nav>
      </div>

      <!-- Task Content -->
      <div class="flex-1 overflow-y-auto p-6">
        <!-- Task Lists -->
        <div data-tasks-target="content">
          <!-- Today View -->
          <div class="task-view active" data-view="today">
            <div class="flex items-center justify-between mb-6">
              <div>
                <h3 class="text-2xl font-bold text-foreground mb-1 flex items-center gap-2">
                  <span>üóìÔ∏è</span>
                  <span>Today</span>
                </h3>
                <p class="text-sm text-muted-foreground" data-tasks-target="todayDate"><%# Will be populated by JavaScript %></p>
              </div>
              <button
                data-action="click->tasks#openCreateModal"
                class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
              >
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                </svg>
                Add Task
              </button>
            </div>
            
            
            <!-- Tasks List -->
            <div data-tasks-target="todayList" class="space-y-2">
              <!-- Tasks will be rendered here -->
            </div>
          </div>

          <!-- Upcoming View -->
          <div class="task-view hidden" data-view="upcoming">
            <div class="flex items-center justify-between mb-6">
              <div>
                <h3 class="text-2xl font-bold text-foreground mb-1 flex items-center gap-2">
                  <span>‚åö</span>
                  <span>Upcoming</span>
                </h3>
                <p class="text-sm text-muted-foreground">Plan ahead and stay organized</p>
              </div>
              <button
                data-action="click->tasks#openCreateModal"
                class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
              >
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                </svg>
                Add Task
              </button>
            </div>
            <div data-tasks-target="upcomingList" class="space-y-2">
              <!-- Upcoming tasks will be rendered here -->
            </div>
          </div>

          <!-- Completed View -->
          <div class="task-view hidden" data-view="completed">
            <div class="mb-6">
              <div>
                <h3 class="text-2xl font-bold text-foreground mb-1 flex items-center gap-2">
                  <span>‚úÖ</span>
                  <span>Completed</span>
                </h3>
                <p class="text-sm text-muted-foreground">Great job on what you've accomplished!</p>
              </div>
            </div>
            <div data-tasks-target="completedList" class="space-y-2">
              <!-- Completed tasks will be rendered here -->
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Settings Modal -->
  <div 
    data-controller="settings"
    data-settings-target="modal"
    data-action="click->settings#closeOnOverlay"
    class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden"
  >
    <div class="bg-card rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-hidden">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-border">
        <h3 class="text-lg font-semibold text-foreground">AI Settings</h3>
        <button 
          data-action="click->settings#close"
          class="text-muted-foreground hover:text-foreground p-1 rounded-lg hover:bg-accent transition-colors"
        >
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-4 overflow-y-auto max-h-[calc(90vh-120px)]">
        <!-- AI Provider Selection -->
        <div class="form-group">
          <label class="block text-sm font-medium text-foreground mb-2">
            AI Provider
          </label>
          <select 
            data-settings-target="provider"
            data-action="change->settings#providerChanged"
            class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="openai">OpenAI (GPT-4, GPT-3.5)</option>
            <option value="anthropic">Anthropic (Claude)</option>
            <option value="custom">Custom Endpoint</option>
          </select>
        </div>

        <!-- Model Selection -->
        <div class="form-group">
          <label class="block text-sm font-medium text-foreground mb-2">
            Model
          </label>
          <select 
            data-settings-target="model"
            class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <!-- Options will be populated by JavaScript -->
          </select>
        </div>

        <!-- API Key -->
        <div class="form-group">
          <label class="block text-sm font-medium text-foreground mb-2">
            API Key
          </label>
          <input
            type="password"
            data-settings-target="apiKey"
            placeholder="Enter your API key"
            class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
          <p class="mt-1 text-xs text-muted-foreground">
            Your API key is encrypted and stored locally in your browser.
          </p>
        </div>

        <!-- Custom Endpoint URL (hidden by default) -->
        <div class="form-group" style="display: none;">
          <label class="block text-sm font-medium text-foreground mb-2">
            Custom Endpoint URL
          </label>
          <input
            type="url"
            data-settings-target="customUrl"
            placeholder="https://api.example.com/v1"
            class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
          <p class="mt-1 text-xs text-muted-foreground">
            OpenAI-compatible endpoint URL.
          </p>
        </div>

        <!-- Test Connection -->
        <div class="form-group">
          <button
            data-settings-target="testButton"
            data-action="click->settings#testConnection"
            class="w-full bg-secondary text-secondary-foreground py-2 px-4 rounded-lg hover:bg-secondary/80 transition-colors"
          >
            Test Connection
          </button>
          <div data-settings-target="testResult" class="mt-2 text-sm" style="display: none;"></div>
        </div>

        <!-- Help Text -->
        <div class="bg-secondary/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-foreground mb-2">Getting API Keys:</h4>
          <ul class="text-xs text-muted-foreground space-y-1">
            <li>‚Ä¢ <strong>OpenAI:</strong> Visit <a href="https://platform.openai.com/api-keys" target="_blank" class="text-primary hover:underline">platform.openai.com/api-keys</a></li>
            <li>‚Ä¢ <strong>Anthropic:</strong> Visit <a href="https://console.anthropic.com/" target="_blank" class="text-primary hover:underline">console.anthropic.com</a></li>
          </ul>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex justify-end gap-3 p-6 border-t border-border">
        <button 
          data-action="click->settings#close"
          class="px-4 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
        >
          Cancel
        </button>
        <button 
          data-action="click->settings#save"
          class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors text-sm"
        >
          Save Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Task Creation Modal -->
  <div 
    data-tasks-target="createModal"
    data-action="click->tasks#closeCreateModalOnOverlay"
    class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden"
  >
    <div class="bg-card rounded-lg shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-border">
        <h3 class="text-lg font-semibold text-foreground">Create New Task</h3>
        <button 
          data-action="click->tasks#closeCreateModal"
          class="text-muted-foreground hover:text-foreground p-1 rounded-lg hover:bg-accent transition-colors"
        >
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <form data-tasks-target="createForm" data-action="submit->tasks#createTask" class="overflow-y-auto max-h-[calc(90vh-120px)]">
        <div class="p-6 space-y-6">
          <!-- Task Title -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2 flex items-center gap-1">
              <span>T</span>
              <span>Task Title</span>
            </label>
            <input
              type="text"
              name="title"
              required
              data-tasks-target="createTitleInput"
              placeholder="Enter task title..."
              class="w-full px-4 py-3 border-2 border-blue-200 rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus:border-blue-500 transition-colors"
            >
          </div>

          <!-- Task Description -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2 flex items-center gap-1">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3,3H21V5H3V3M3,7H15V9H3V7M3,11H21V13H3V11M3,15H15V17H3V15M3,19H21V21H3V19Z"/>
              </svg>
              <span>Description (Optional)</span>
            </label>
            <textarea
              name="description"
              rows="4"
              placeholder="Add details about this task..."
              class="w-full px-4 py-3 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary resize-none"
            ></textarea>
          </div>

          <!-- Category and Priority -->
          <div class="grid grid-cols-2 gap-4">
            <!-- Category -->
            <div class="form-group">
              <label class="block text-sm font-medium text-foreground mb-2 flex items-center gap-1">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"/>
                </svg>
                <span>Category</span>
              </label>
              <select 
                name="category_id"
                data-tasks-target="categorySelect"
                class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary appearance-none"
              >
                <option value="">No Category</option>
              </select>
            </div>

            <!-- Priority -->
            <div class="form-group">
              <label class="block text-sm font-medium text-foreground mb-2 flex items-center gap-1">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                </svg>
                <span>Priority</span>
              </label>
              <select 
                name="priority"
                class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary appearance-none"
              >
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>

          </div>

          <!-- Due Date -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2 flex items-center gap-1">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19,3H18V1H16V3H8V1H6V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
              </svg>
              <span>Due Date (Optional)</span>
            </label>
            <input
              type="date"
              name="due_date"
              placeholder="jj/mm/aaaa"
              class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            >
          </div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="flex justify-end gap-3 p-6 border-t border-border">
          <button 
            type="button"
            data-action="click->tasks#closeCreateModal"
            class="px-6 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
          >
            Cancel
          </button>
          <button 
            type="submit"
            class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
          >
            Create Task
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Task Edit Modal -->
  <div 
    data-tasks-target="editModal"
    data-action="click->tasks#closeEditModalOnOverlay"
    class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden"
  >
    <div class="bg-card rounded-lg shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-border">
        <h3 class="text-lg font-semibold text-foreground">Edit Task</h3>
        <button 
          data-action="click->tasks#closeEditModal"
          class="text-muted-foreground hover:text-foreground p-1 rounded-lg hover:bg-accent transition-colors"
        >
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <form data-tasks-target="editForm" data-action="submit->tasks#updateTask" class="overflow-y-auto max-h-[calc(90vh-120px)]">
        <input type="hidden" name="task_id" data-tasks-target="editTaskId">
        
        <div class="p-6 space-y-4">
          <!-- Task Title -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2">
              Task Title *
            </label>
            <input
              type="text"
              name="title"
              required
              data-tasks-target="editTitle"
              placeholder="Enter task title..."
              class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            >
          </div>

          <!-- Task Description -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2">
              Description
            </label>
            <textarea
              name="description"
              rows="3"
              data-tasks-target="editDescription"
              placeholder="Enter task description..."
              class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            ></textarea>
          </div>

          <!-- Category and Priority -->
          <div class="grid grid-cols-2 gap-4">
            <!-- Category -->
            <div class="form-group">
              <label class="block text-sm font-medium text-foreground mb-2">
                Category
              </label>
              <select 
                name="category_id"
                data-tasks-target="editCategorySelect"
                class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="">No Category</option>
                <!-- Categories will be populated by JavaScript -->
              </select>
            </div>

            <!-- Priority -->
            <div class="form-group">
              <label class="block text-sm font-medium text-foreground mb-2">
                Priority
              </label>
              <select 
                name="priority"
                data-tasks-target="editPriority"
                class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>

          <!-- Due Date -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2">
              Due Date
            </label>
            <input
              type="date"
              name="due_date"
              data-tasks-target="editDueDate"
              class="w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            >
          </div>

          <!-- Subtasks Section -->
          <div class="form-group">
            <label class="block text-sm font-medium text-foreground mb-2">
              Subtasks
            </label>
            <div data-tasks-target="subtasksList" class="space-y-2 mb-3">
              <!-- Subtasks will be rendered here -->
            </div>
            <div class="flex gap-2">
              <input
                type="text"
                data-tasks-target="newSubtaskInput"
                placeholder="Add a subtask..."
                class="flex-1 px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
              <button
                type="button"
                data-action="click->tasks#addSubtask"
                class="px-3 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors"
              >
                Add
              </button>
            </div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="flex justify-between p-6 border-t border-border">
          <button 
            type="button"
            data-action="click->tasks#deleteTask"
            class="px-4 py-2 bg-destructive text-destructive-foreground rounded-lg hover:bg-destructive/90 transition-colors text-sm"
          >
            Delete Task
          </button>
          <div class="flex gap-3">
            <button 
              type="button"
              data-action="click->tasks#closeEditModal"
              class="px-4 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
            >
              Cancel
            </button>
            <button 
              type="submit"
              class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors text-sm"
            >
              Update Task
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Category Management Modal -->
  <div 
    data-tasks-target="categoryModal"
    data-action="click->tasks#closeCategoryModalOnOverlay"
    class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 hidden"
  >
    <div class="bg-card rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-hidden">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-border">
        <h3 class="text-lg font-semibold text-foreground">Manage Categories</h3>
        <button 
          data-action="click->tasks#closeCategoryModal"
          class="text-muted-foreground hover:text-foreground p-1 rounded-lg hover:bg-accent transition-colors"
        >
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-4 overflow-y-auto max-h-[calc(90vh-180px)]">
        <!-- Add New Category -->
        <form data-tasks-target="categoryForm" data-action="submit->tasks#createCategory" class="space-y-3 p-4 border border-border rounded-lg">
          <h4 class="font-medium text-foreground">Add New Category</h4>
          <div class="flex gap-2">
            <input
              type="text"
              name="name"
              required
              placeholder="Category name..."
              class="flex-1 px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            >
            <input
              type="color"
              name="color"
              value="#6B7280"
              class="w-12 h-10 border border-border rounded-lg cursor-pointer"
            >
            <button
              type="submit"
              class="px-3 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors"
            >
              Add
            </button>
          </div>
        </form>

        <!-- Existing Categories -->
        <div>
          <h4 class="font-medium text-foreground mb-3">Existing Categories</h4>
          <div data-tasks-target="categoriesList" class="space-y-2">
            <!-- Categories will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex justify-end gap-3 p-6 border-t border-border">
        <button 
          data-action="click->tasks#closeCategoryModal"
          class="px-4 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>